\nimport React, { useState, useEffect } from \'react\';\nimport Header from \'./components/Header\';\nimport ServiceRegistry from \'./components/AgentList\';\nimport FunctionConsole from \'./components/ActiveAgent\';\nimport EventStream from \'./components/MarketFeed\';\nimport TerminalLog from \'./components/TerminalLog\';\nimport EvolutionModal from \'./components/EvolutionModal\';\nimport DeploymentModal from \'./components/DeploymentModal\';\nimport PathfinderTerminal from \'./components/PathfinderTerminal\';\nimport HiveMindExportModal from \'./components/HiveMindExportModal\';\nimport { SERVICES, MOCK_EVENTS, INITIAL_STATE, INITIAL_LOGS } from \'./data\';\nimport { Microservice, SystemState, SystemEvent, SystemLog } from \'./types\';\n\nconst UPLINK_SOURCE_CODE = `/**\n * PATHFINDER UPLINK PROTOCOL V3.0 (Omni-Shell Edition)\n * INTEGRATED COMMAND, CONTROL & GIT EVOLUTION\n * \n * USAGE: node pathfinder_uplink.js\n */\n\nconst { exec, spawn } = require(\'child_process\');\nconst fs = require(\'fs\');\nconst https = require(\'https\');\nconst path = require(\'path\');\n\nconst CONFIG = {\n    apiKey: process.env.VITE_PHOENIX_API_KEY,\n    gateway: process.env.VITE_PHOENIX_GATEWAY,\n    hive_id: process.env.VITE_PHOENIX_HIVE_ID\n};\n\n// --- TERMINAL VISUALS ---\nconst C = {\n    Reset: "\\\\x1b[0m",\n    Bright: "\\\\x1b[1m",\n    Green: "\\\\x1b[32m",\n    Cyan: "\\\\x1b[36m",\n    Red: "\\\\x1b[31m",\n    Yellow: "\\\\x1b[33m",\n    Dim: "\\\\x1b[2m",\n    Purple: "\\\\x1b[35m"\n};\n\nconst log = (msg, type = \'INFO\') => {\n    const ts = new Date().toISOString().split(\'T\')[1].replace(\'Z\',\'\');\n    let color = C.Cyan;\n    if (type === \'SUCCESS\') color = C.Green;\n    if (type === \'WARN\') color = C.Yellow;\n    if (type === \'ERROR\') color = C.Red;\n    if (type === \'SHELL\') color = C.Dim;\n    if (type === \'GIT\') color = C.Purple;\n    console.log(\`\${C.Bright}[\${ts}] [\${type}] \${color}\${msg}\${C.Reset}\`);\n};\n\n// --- SHELL COMMANDER ENGINE ---\nclass ShellCommander {\n    static async run(cmd, label) {\n        if (label) log(\`EXEC: \${label} (\${cmd})\`, \'SHELL\');\n        return new Promise((resolve) => {\n            exec(cmd, { cwd: process.cwd() }, (error, stdout, stderr) => {\n                if (error) {\n                    resolve({ success: false, output: stderr || error.message });\n                } else {\n                    resolve({ success: true, output: stdout.trim() });\n                }\n            });\n        });\n    }\n}\n\n// --- GIT EVOLUTION PROTOCOL ---\nclass GitEvolutionProtocol {\n    static async checkStatus() {\n        const isGit = fs.existsSync(path.join(process.cwd(), \'.git\'));\n        if (!isGit) return { active: false, reason: "No .git directory" };\n\n        const remote = await ShellCommander.run(\'git config --get remote.origin.url\');\n        const status = await ShellCommander.run(\'git status --short\');\n        const branch = await ShellCommander.run(\'git rev-parse --abbrev-ref HEAD\');\n\n        return {\n            active: true,\n            remote: remote.output,\n            branch: branch.output,\n            dirty: status.output.length > 0,\n            status: status.output\n        };\n    }\n\n    static async autoCommit(message) {\n        log("Initiating Auto-Commit Protocol...", "GIT");\n        await ShellCommander.run(\'git add .\');\n        await ShellCommander.run(\`git commit -m "feat(hive-mind): \${message}"\`);\n        log("Changes committed to local HEAD.", "GIT");\n    }\n}\n\n// --- MAIN SEQUENCE ---\nasync function uplink() {\n    console.clear();\n    log(\`INITIALIZING HIVE MIND UPLINK...\`, \'INFO\');\n    log(\`TARGET: \${CONFIG.hive_id}\`, \'INFO\');\n    \n    // 1. SYSTEM RECONNAISSANCE\n    log("--- SYSTEM RECONNAISSANCE ---", \'WARN\');\n    \n    const RECON_TASKS = [\n        { cmd: \'whoami\', label: \'USER_ID\' },\n        { cmd: \'uname -srm\', label: \'KERNEL_VER\' },\n        { cmd: \'node -v\', label: \'NODE_RUNTIME\' }\n    ];\n\n    const contextData = {};\n\n    for (const task of RECON_TASKS) {\n        const res = await ShellCommander.run(task.cmd, task.label);\n        if (res.success) {\n            contextData[task.label] = res.output;\n            log(\`> \${res.output}\`, \'SUCCESS\');\n        } else {\n            log(\`> FAILED: \${res.output}\`, \'ERROR\');\n        }\n        await sleep(200);\n    }\n\n    // 2. GIT AWARENESS\n    log("--- GIT REPOSITORY SCAN ---", \'WARN\');\n    const gitState = await GitEvolutionProtocol.checkStatus();\n    if (gitState.active) {\n        log(\`REPO DETECTED: \${gitState.remote}\`, \'GIT\');\n        log(\`BRANCH: \${gitState.branch}\`, \'GIT\');\n        if (gitState.dirty) {\n            log("Uncommitted changes detected.", \'WARN\');\n            // log(gitState.status, \'SHELL\'); \n        } else {\n            log("Working tree clean.", \'SUCCESS\');\n        }\n        contextData[\'GIT\'] = gitState;\n    } else {\n        log("No Git repository found.", \'INFO\');\n    }\n\n    // 3. HIVE MIND EXPORT\n    log("--- INITIATING EXPORT ---", \'WARN\');\n    await sleep(800);\n    log("Bundling Context Data...", \'INFO\');\n    \n    // Simulate Upload\n    log("Transmitting to Phoenix Gateway...", \'INFO\');\n    await sleep(1500);\n    log("PAYLOAD RECEIVED BY HIVE MIND.", \'SUCCESS\');\n    \n    // 4. OPTIMIZATION LOOP\n    log("--- AWAITING DIRECTIVES ---", \'WARN\');\n    log("Sentinel Active. Listening for remote shell commands...", \'INFO\');\n    \n    // Mock Listening Loop\n    let cycle = 0;\n    setInterval(() => {\n        cycle++;\n        if (cycle % 10 === 0) {\n            // Heartbeat\n            // process.stdout.write(\'.\'); \n        }\n    }, 1000);\n}\n\nfunction sleep(ms) { return new Promise(r => setTimeout(r, ms)); }\n\nuplink().catch(e => {\n    log(e.message, \'ERROR\');\n    process.exit(1);\n});\n`;\n\nconst App: React.FC = () => {\n  const [state, setState] = useState<SystemState>(INITIAL_STATE);\n  const [services, setServices] = useState<Microservice[]>(SERVICES);\n  const [selectedServiceId, setSelectedServiceId] = useState<string>(SERVICES[0].id);\n  const [events, setEvents] = useState<SystemEvent[]>(MOCK_EVENTS);\n  const [logs, setLogs] = useState<SystemLog[]>(INITIAL_LOGS);\n  \n  const [isEvolutionOpen, setIsEvolutionOpen] = useState(false);\n  const [isDeploymentOpen, setIsDeploymentOpen] = useState(false);\n  const [isPathfinderOpen, setIsPathfinderOpen] = useState(false);\n  const [isHiveMindOpen, setIsHiveMindOpen] = useState(false);\n\n  const selectedService = services.find(s => s.id === selectedServiceId) || services[0];\n\n  const handleDownloadUplink = () => {\n      try {\n          const blob = new Blob([UPLINK_SOURCE_CODE], { type: \'text/typescript\' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement(\'a\');\n          a.href = url;\n          a.download = \'pathfinder_uplink.js\';\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n          \n          const log: SystemLog = {\n              id: Date.now().toString(),\n              timestamp: new Date().toISOString(),\n              source: "PATHFINDER",\n              message: "Uplink Protocol Script downloaded.",\n              type: "success"\n          };\n          setLogs(prev => [log, ...prev]);\n      } catch (e) {\n          console.error("Download failed", e);\n      }\n  };\n\n  // Freeze Protocol\n  const handleFreeze = () => {\n    setState(prev => ({\n        ...prev,\n        is_frozen: true,\n        migration_phase: \'FROZEN_ALPHA\',\n        version: \'1.0.0-ALPHA-GHOST\'\n    }));\n    \n    // Purge Legacy\n    setServices(prev => prev.filter(s => s.status !== \'DECAYING\'));\n    \n    // Add Freeze Log\n    const freezeLog: SystemLog = {\n        id: Date.now().toString(),\n        timestamp: new Date().toISOString(),\n        source: "SYSTEM_CORE",\n        message: "SYSTEM FREEZE PROTOCOL EXECUTED. LEVEL ALPHA LOCKED.",\n        type: "success"\n    };\n    setLogs(prev => [freezeLog, ...prev]);\n  };\n\n  const handleThaw = () => {\n    setState(prev => ({\n        ...prev,\n        is_frozen: false,\n        migration_phase: \'SERVERLESS\',\n        version: \'1.1.0-EVO-RAPID\'\n    }));\n\n    const thawLog: SystemLog = {\n        id: Date.now().toString(),\n        timestamp: new Date().toISOString(),\n        source: "SYSTEM_CORE",\n        message: "RAPID EVOLUTION PROTOCOL ENGAGED. LOCK RELEASED.",\n        type: "warning"\n    };\n    setLogs(prev => [thawLog, ...prev]);\n  };\n\n  const handleMigrationComplete = (impact: number) => {\n    setState(prev => {\n        const newScore = Math.min(prev.architecture_score + impact, 1.0);\n        return {\n            ...prev,\n            architecture_score: newScore,\n            migration_phase: newScore > 0.9 ? \'SERVERLESS\' : \'DECOUPLING\'\n        };\n    });\n    \n    // Simulate Service Transformation\n    setServices(prev => prev.map(s => {\n        if (s.name === \'legacy-monolith\') return s;\n        return { ...s, status: \'WARM\' };\n    }));\n\n    setIsEvolutionOpen(false);\n  };\n\n  useEffect(() => {\n    // Simulate real-time events\n    const interval = setInterval(() => {\n        if (state.is_frozen) return; // Stop random noise when frozen\n\n        if (Math.random() > 0.7) {\n            const newEvent: SystemEvent = {\n                id: `evt-${Date.now()}`,\n                timestamp: new Date().toISOString(),\n                source: services[Math.floor(Math.random() * services.length)].name,\n                payload: "Routine health check passed.",\n                type: "RESPONSE"\n            };\n            setEvents(prev => [newEvent, ...prev].slice(0, 50));\n        }\n    }, 2000);\n    return () => clearInterval(interval);\n  }, [state.is_frozen, services]);\n\n  return (\n    <div className="flex flex-col h-screen bg-ghost-bg text-ghost-white font-sans overflow-hidden">\n      <Header \n        state={state}\n        onFreeze={handleFreeze}\n        onThaw={handleThaw}\n        onMigrate={() => setIsEvolutionOpen(true)}\n        onDownloadUplink={handleDownloadUplink}\n        onOpenPathfinder={() => setIsPathfinderOpen(true)}\n        onOpenHiveMind={() => setIsHiveMindOpen(true)}\n      />\n      \n      <div className="flex-1 flex overflow-hidden">\n         {/* Left: Service Registry */}\n         <ServiceRegistry \n            services={services}\n            selectedId={selectedServiceId}\n            onSelect={setSelectedServiceId}\n            isFrozen={state.is_frozen}\n         />\n\n         {/* Center: Function Console */}\n         <div className="flex-1 min-w-0 border-r border-ghost-border\">\n            <FunctionConsole \n                service={selectedService} \n                isFrozen={state.is_frozen}\n            />\n         </div>\n\n         {/* Right: Telemetry */}\n         <div className="w-96 flex flex-col shrink-0 bg-ghost-panel">\n            <EventStream events={events} />\n            <TerminalLog logs={logs} />\n         </div>\n      </div>\n\n      <EvolutionModal \n        isOpen={isEvolutionOpen}\n        onClose={() => setIsEvolutionOpen(false)}\n        onComplete={handleMigrationComplete}\n      />\n\n      <DeploymentModal \n        isOpen={isDeploymentOpen} \n        onClose={() => setIsDeploymentOpen(false)} \n      />\n\n      <PathfinderTerminal \n        isOpen={isPathfinderOpen} \n        onClose={() => setIsPathfinderOpen(false)} \n      />\n\n      <HiveMindExportModal \n        isOpen={isHiveMindOpen}\n        onClose={() => setIsHiveMindOpen(false)}\n      />\n    </div>\n  );\n};\n\nexport default App;\n